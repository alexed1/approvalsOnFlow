From 8baeffcd1b5102417bfeeed0f4cee6dc545b5ef9 Mon Sep 17 00:00:00 2001
From: Alex Edelstein <aedelstein@salesforce.comm>
Date: Sun, 29 Sep 2019 20:34:39 -0700
Subject: [PATCH 3/4] more changes

---
 .../AP_Edit_Approval_Processes.flow-meta.xml  |  10 +-
 ...Manage_Approval_Process_Step.flow-meta.xml |   2 +-
 ...AP_Manage_Approval_Processes.flow-meta.xml | 159 ++++--------------
 3 files changed, 32 insertions(+), 139 deletions(-)

diff --git a/force-app/main/default/flows/AP_Edit_Approval_Processes.flow-meta.xml b/force-app/main/default/flows/AP_Edit_Approval_Processes.flow-meta.xml
index d65a77c..f489e31 100644
--- a/force-app/main/default/flows/AP_Edit_Approval_Processes.flow-meta.xml
+++ b/force-app/main/default/flows/AP_Edit_Approval_Processes.flow-meta.xml
@@ -227,7 +227,7 @@ TODO: implement the enforceSingleMember flag and detect returned errors</descrip
         <name>Get_ApprovalProcess_Step_Definitions</name>
         <label>Get ApprovalProcess Step Definitions</label>
         <locationX>1041</locationX>
-        <locationY>82</locationY>
+        <locationY>83</locationY>
         <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
         <connector>
             <targetReference>Count_Step_Definitions</targetReference>
@@ -571,14 +571,6 @@ TODO: implement the enforceSingleMember flag and detect returned errors</descrip
             <stringValue>Name,Name,text;</stringValue>
         </value>
     </variables>
-    <variables>
-        <description>This should be the ID of the record for which approval is being sought</description>
-        <name>contextRecordId</name>
-        <dataType>String</dataType>
-        <isCollection>false</isCollection>
-        <isInput>true</isInput>
-        <isOutput>true</isOutput>
-    </variables>
     <variables>
         <name>curApprovalProcessDefinition</name>
         <dataType>SObject</dataType>
diff --git a/force-app/main/default/flows/AP_Manage_Approval_Process_Step.flow-meta.xml b/force-app/main/default/flows/AP_Manage_Approval_Process_Step.flow-meta.xml
index 5d8641c..82655f8 100644
--- a/force-app/main/default/flows/AP_Manage_Approval_Process_Step.flow-meta.xml
+++ b/force-app/main/default/flows/AP_Manage_Approval_Process_Step.flow-meta.xml
@@ -5,7 +5,7 @@
         <name>Assign_Name_to</name>
         <label>Update Current Step Def</label>
         <locationX>738</locationX>
-        <locationY>522</locationY>
+        <locationY>523</locationY>
         <assignmentItems>
             <assignToReference>curApprovalProcessStepDefinition.Name</assignToReference>
             <operator>Assign</operator>
diff --git a/force-app/main/default/flows/AP_Manage_Approval_Processes.flow-meta.xml b/force-app/main/default/flows/AP_Manage_Approval_Processes.flow-meta.xml
index 8c89dfe..a1daf3d 100644
--- a/force-app/main/default/flows/AP_Manage_Approval_Processes.flow-meta.xml
+++ b/force-app/main/default/flows/AP_Manage_Approval_Processes.flow-meta.xml
@@ -1,33 +1,11 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <Flow xmlns="http://soap.sforce.com/2006/04/metadata">
-    <actionCalls>
-        <description>We&#39;ll</description>
-        <name>Get_Object_Name_for_Process_Definition</name>
-        <label>Get Object Name for Process Definition</label>
-        <locationX>411</locationX>
-        <locationY>945</locationY>
-        <actionName>GetObjectTypeFromRecordId</actionName>
-        <actionType>apex</actionType>
-        <connector>
-            <targetReference>Create_Approval_Process_Definition</targetReference>
-        </connector>
-        <inputParameters>
-            <name>recordId</name>
-            <value>
-                <elementReference>recordId</elementReference>
-            </value>
-        </inputParameters>
-        <outputParameters>
-            <assignToReference>curApprovalProcessDefinition.ContextObjectTypeName__c</assignToReference>
-            <name>objectType</name>
-        </outputParameters>
-    </actionCalls>
     <assignments>
         <description>Start assembling the Approval Process Definition</description>
-        <name>Add_Name_to_Process</name>
-        <label>Add Name to Process</label>
-        <locationX>278</locationX>
-        <locationY>944</locationY>
+        <name>Configure_Definition</name>
+        <label>Configure Definition</label>
+        <locationX>562</locationX>
+        <locationY>733</locationY>
         <assignmentItems>
             <assignToReference>curApprovalProcessDefinition.Name</assignToReference>
             <operator>Assign</operator>
@@ -35,8 +13,15 @@
                 <elementReference>Approval_Process_Name</elementReference>
             </value>
         </assignmentItems>
+        <assignmentItems>
+            <assignToReference>curApprovalProcessDefinition.ContextObjectTypeName__c</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <elementReference>AssociatedObjectType</elementReference>
+            </value>
+        </assignmentItems>
         <connector>
-            <targetReference>Get_Object_Name_for_Process_Definition</targetReference>
+            <targetReference>Create_Approval_Process_Definition</targetReference>
         </connector>
     </assignments>
     <choices>
@@ -55,14 +40,6 @@
             <stringValue>Delete</stringValue>
         </value>
     </choices>
-    <choices>
-        <name>deleteChoice</name>
-        <choiceText>Delete an Approval Process</choiceText>
-        <dataType>String</dataType>
-        <value>
-            <stringValue>delete</stringValue>
-        </value>
-    </choices>
     <choices>
         <name>Done</name>
         <choiceText>Done with steps</choiceText>
@@ -93,14 +70,14 @@
         <locationX>1010</locationX>
         <locationY>322</locationY>
         <defaultConnector>
-            <targetReference>Edit_or_Delete</targetReference>
+            <targetReference>Get_Selected_Approval_Process</targetReference>
         </defaultConnector>
         <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
         <rules>
             <name>Is_Null</name>
             <conditionLogic>and</conditionLogic>
             <conditions>
-                <leftValueReference>selectedApprovalProcessDefinitionId</leftValueReference>
+                <leftValueReference>existingApprovalProcessDefinitionId</leftValueReference>
                 <operator>IsNull</operator>
                 <rightValue>
                     <booleanValue>true</booleanValue>
@@ -118,7 +95,7 @@
         <locationX>381</locationX>
         <locationY>732</locationY>
         <defaultConnector>
-            <targetReference>Add_Name_to_Process</targetReference>
+            <targetReference>Configure_Definition</targetReference>
         </defaultConnector>
         <defaultConnectorLabel>Name Available</defaultConnectorLabel>
         <rules>
@@ -159,39 +136,7 @@
             <label>Create Approval Process</label>
         </rules>
         <rules>
-            <name>Edit_or_Delete_Approval_Process</name>
-            <conditionLogic>or</conditionLogic>
-            <conditions>
-                <leftValueReference>ApprovalProcessAction</leftValueReference>
-                <operator>EqualTo</operator>
-                <rightValue>
-                    <elementReference>edit_choice</elementReference>
-                </rightValue>
-            </conditions>
-            <conditions>
-                <leftValueReference>ApprovalProcessAction</leftValueReference>
-                <operator>EqualTo</operator>
-                <rightValue>
-                    <elementReference>deleteChoice</elementReference>
-                </rightValue>
-            </conditions>
-            <connector>
-                <targetReference>Get_Approval_Process_Definitions</targetReference>
-            </connector>
-            <label>Edit or Delete Approval Process</label>
-        </rules>
-    </decisions>
-    <decisions>
-        <name>Edit_or_Delete</name>
-        <label>Edit or Delete?</label>
-        <locationX>1008</locationX>
-        <locationY>524</locationY>
-        <defaultConnector>
-            <targetReference>Delete_Selected_Approval_Process</targetReference>
-        </defaultConnector>
-        <defaultConnectorLabel>Delete</defaultConnectorLabel>
-        <rules>
-            <name>EditApprovalProcess2</name>
+            <name>Edit_Approval_Process</name>
             <conditionLogic>and</conditionLogic>
             <conditions>
                 <leftValueReference>ApprovalProcessAction</leftValueReference>
@@ -201,9 +146,9 @@
                 </rightValue>
             </conditions>
             <connector>
-                <targetReference>Get_Selected_Approval_Process</targetReference>
+                <targetReference>Get_Approval_Process_Definitions</targetReference>
             </connector>
-            <label>Edit</label>
+            <label>Edit Approval Process</label>
         </rules>
     </decisions>
     <decisions>
@@ -257,23 +202,6 @@
         </connector>
         <inputReference>curApprovalProcessDefinition</inputReference>
     </recordCreates>
-    <recordDeletes>
-        <name>Delete_Selected_Approval_Process</name>
-        <label>Delete Selected Approval Process</label>
-        <locationX>1015</locationX>
-        <locationY>1091</locationY>
-        <connector>
-            <targetReference>DeleteConfirmation</targetReference>
-        </connector>
-        <filters>
-            <field>Id</field>
-            <operator>EqualTo</operator>
-            <value>
-                <elementReference>selectedApprovalProcessDefinitionId</elementReference>
-            </value>
-        </filters>
-        <object>ApprovalProcessDefinition__c</object>
-    </recordDeletes>
     <recordLookups>
         <name>Get_Approval_Process_Definitions</name>
         <label>Get Approval Process Definitions</label>
@@ -305,7 +233,7 @@
             <field>Id</field>
             <operator>EqualTo</operator>
             <value>
-                <elementReference>selectedApprovalProcessDefinitionId</elementReference>
+                <elementReference>existingApprovalProcessDefinitionId</elementReference>
             </value>
         </filters>
         <object>ApprovalProcessDefinition__c</object>
@@ -335,8 +263,8 @@
     <screens>
         <name>Create_or_Edit</name>
         <label>Create or Edit</label>
-        <locationX>133</locationX>
-        <locationY>49</locationY>
+        <locationX>263</locationX>
+        <locationY>50</locationY>
         <allowBack>true</allowBack>
         <allowFinish>true</allowFinish>
         <allowPause>true</allowPause>
@@ -352,7 +280,6 @@
             <name>ApprovalProcessAction</name>
             <choiceReferences>create_Choice</choiceReferences>
             <choiceReferences>edit_choice</choiceReferences>
-            <choiceReferences>deleteChoice</choiceReferences>
             <dataType>String</dataType>
             <fieldText>Select an Action</fieldText>
             <fieldType>RadioButtons</fieldType>
@@ -361,25 +288,6 @@
         <showFooter>true</showFooter>
         <showHeader>false</showHeader>
     </screens>
-    <screens>
-        <name>DeleteConfirmation</name>
-        <label>DeleteConfirmation</label>
-        <locationX>123</locationX>
-        <locationY>1363</locationY>
-        <allowBack>true</allowBack>
-        <allowFinish>true</allowFinish>
-        <allowPause>true</allowPause>
-        <connector>
-            <targetReference>Create_or_Edit</targetReference>
-        </connector>
-        <fields>
-            <name>dispDeleteConfirm</name>
-            <fieldText>&lt;p&gt;Approval Process deleted.&lt;/p&gt;</fieldText>
-            <fieldType>DisplayText</fieldType>
-        </fields>
-        <showFooter>true</showFooter>
-        <showHeader>true</showHeader>
-    </screens>
     <screens>
         <name>Error</name>
         <label>Error!!</label>
@@ -441,6 +349,13 @@
             <fieldType>InputField</fieldType>
             <isRequired>true</isRequired>
         </fields>
+        <fields>
+            <name>AssociatedObjectType</name>
+            <dataType>String</dataType>
+            <fieldText>Associated Object Type (Account, Foo__c, etc)</fieldText>
+            <fieldType>InputField</fieldType>
+            <isRequired>false</isRequired>
+        </fields>
         <showFooter>true</showFooter>
         <showHeader>false</showHeader>
     </screens>
@@ -503,7 +418,7 @@
             </inputParameters>
             <isRequired>true</isRequired>
             <outputParameters>
-                <assignToReference>selectedApprovalProcessDefinitionId</assignToReference>
+                <assignToReference>existingApprovalProcessDefinitionId</assignToReference>
                 <name>recordId</name>
             </outputParameters>
         </fields>
@@ -524,12 +439,6 @@
         <locationX>830</locationX>
         <locationY>726</locationY>
         <flowName>AP_Edit_Approval_Processes</flowName>
-        <inputAssignments>
-            <name>contextRecordId</name>
-            <value>
-                <elementReference>recordId</elementReference>
-            </value>
-        </inputAssignments>
         <inputAssignments>
             <name>curApprovalProcessDefinition</name>
             <value>
@@ -584,15 +493,7 @@
         </value>
     </variables>
     <variables>
-        <description>This is the record for which approval is being sought.</description>
-        <name>recordId</name>
-        <dataType>String</dataType>
-        <isCollection>false</isCollection>
-        <isInput>true</isInput>
-        <isOutput>false</isOutput>
-    </variables>
-    <variables>
-        <name>selectedApprovalProcessDefinitionId</name>
+        <name>existingApprovalProcessDefinitionId</name>
         <dataType>String</dataType>
         <isCollection>false</isCollection>
         <isInput>false</isInput>
-- 
2.21.0 (Apple Git-120)

