From 387ffcf5c0dafc09e81820851e589e21885beedb Mon Sep 17 00:00:00 2001
From: Alex Edelstein <aedelstein@salesforce.comm>
Date: Thu, 3 Oct 2019 19:47:45 -0700
Subject: [PATCH] got the User Approve Reject working.

---
 .../default/classes/ApprovalProcessHelper.cls |  16 +-
 ...Manage_Approval_Process_Step.flow-meta.xml |   9 +-
 ...AP_Manage_Approval_Processes.flow-meta.xml |   4 +-
 .../AP_User_Approves_or_Rejects.flow-meta.xml |  80 ++-
 ...ONE_AP_Manage_Step_Approvers.flow-meta.xml | 430 ++++++++++++++
 ...Manage_Approval_Process_Step.flow-meta.xml | 549 ++++++++++++++++++
 .../Manage_Step_Reordering.flow-meta.xml      |  49 +-
 .../approvalProcessHistory.js                 |  11 +-
 .../approvalProcessHistory.js-meta.xml        |   5 +
 .../main/default/lwc/buttonSet/buttonSet.html |   1 +
 .../main/default/lwc/buttonSet/buttonSet.js   |  17 +
 .../lwc/buttonSet/buttonSet.js-meta.xml       |   2 +
 .../manageApprovalProcessStep.js              |   4 +-
 .../manageApprovalProcessStep.js-meta.xml     |   2 +
 .../listViews/All.listView-meta.xml           |  11 +
 .../listViews/All.listView-meta.xml           |   2 +
 .../listViews/All.listView-meta.xml           |   7 +
 .../ApprovalsOnFlow.permissionset-meta.xml    |  10 +
 18 files changed, 1185 insertions(+), 24 deletions(-)
 create mode 100644 force-app/main/default/flows/CLONE_AP_Manage_Step_Approvers.flow-meta.xml
 create mode 100644 force-app/main/default/flows/Clone_AP_Manage_Approval_Process_Step.flow-meta.xml
 create mode 100644 force-app/main/default/objects/ApprovalInstanceHistory__c/listViews/All.listView-meta.xml
 create mode 100644 force-app/main/default/objects/ApprovalProcessInstance__c/listViews/All.listView-meta.xml

diff --git a/force-app/main/default/classes/ApprovalProcessHelper.cls b/force-app/main/default/classes/ApprovalProcessHelper.cls
index e5b3b6a..c2b8185 100644
--- a/force-app/main/default/classes/ApprovalProcessHelper.cls
+++ b/force-app/main/default/classes/ApprovalProcessHelper.cls
@@ -1,11 +1,15 @@
 public with sharing class ApprovalProcessHelper {
     @AuraEnabled(cacheable=true)
-    public static String getApprovalProcessHistory(Id processId) {
-        List<Approval_Process_Step_Task__c> tasks = [
-                SELECT Id, Name, Status__c, Comments__c, (SELECT Id, CreatedDate, Comments__c, Status__c, Original_User__c,Original_User__r.Name, Assigned_User__c, Assigned_User__r.Name FROM AP_ApprovalInstanceHistoryItems__r)
-                FROM Approval_Process_Step_Task__c
-                WHERE Parent_Approval_Process_Instance__r.ApprovalProcessDefinition__c = :processId
+    public static String getApprovalProcessHistory(Id processInstanceId) {
+        System.debug('querying for approval process history');
+        List<ApprovalInstanceHistory__c> historyItems = [
+                SELECT Id, CreatedDate, Comments__c, Status__c, Original_User__c,Original_User__r.Name, Assigned_User__c, Assigned_User__r.Name
+                FROM ApprovalInstanceHistory__c
+                WHERE Approval_Process_Instance__c = :processInstanceId
         ];
-        return JSON.serialize(tasks);
+
+
+      
+        return JSON.serialize(historyItems);
     }
 }
\ No newline at end of file
diff --git a/force-app/main/default/flows/AP_Manage_Approval_Process_Step.flow-meta.xml b/force-app/main/default/flows/AP_Manage_Approval_Process_Step.flow-meta.xml
index 82655f8..7a5958f 100644
--- a/force-app/main/default/flows/AP_Manage_Approval_Process_Step.flow-meta.xml
+++ b/force-app/main/default/flows/AP_Manage_Approval_Process_Step.flow-meta.xml
@@ -4,7 +4,7 @@
         <description>On an edit the full Step Def is passed in from the parent. In the case of an Add, we&#39;ve just received the Name and generated the ID. The ID has just been overwritten onto the main Step Def variable, and now we need to add the Name.</description>
         <name>Assign_Name_to</name>
         <label>Update Current Step Def</label>
-        <locationX>738</locationX>
+        <locationX>737</locationX>
         <locationY>523</locationY>
         <assignmentItems>
             <assignToReference>curApprovalProcessStepDefinition.Name</assignToReference>
@@ -27,6 +27,13 @@
                 <stringValue>&quot;&quot;</stringValue>
             </value>
         </assignmentItems>
+        <assignmentItems>
+            <assignToReference>curApprovalProcessStepDefinition.SingleApproverOrMultiple__c</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <stringValue>Single</stringValue>
+            </value>
+        </assignmentItems>
         <connector>
             <targetReference>Step_Added</targetReference>
         </connector>
diff --git a/force-app/main/default/flows/AP_Manage_Approval_Processes.flow-meta.xml b/force-app/main/default/flows/AP_Manage_Approval_Processes.flow-meta.xml
index a1daf3d..ad85e82 100644
--- a/force-app/main/default/flows/AP_Manage_Approval_Processes.flow-meta.xml
+++ b/force-app/main/default/flows/AP_Manage_Approval_Processes.flow-meta.xml
@@ -330,7 +330,7 @@
         <name>screenCreateApprovalProcess</name>
         <label>Create Approval Process</label>
         <locationX>265</locationX>
-        <locationY>386</locationY>
+        <locationY>385</locationY>
         <allowBack>true</allowBack>
         <allowFinish>true</allowFinish>
         <allowPause>true</allowPause>
@@ -354,7 +354,7 @@
             <dataType>String</dataType>
             <fieldText>Associated Object Type (Account, Foo__c, etc)</fieldText>
             <fieldType>InputField</fieldType>
-            <isRequired>false</isRequired>
+            <isRequired>true</isRequired>
         </fields>
         <showFooter>true</showFooter>
         <showHeader>false</showHeader>
diff --git a/force-app/main/default/flows/AP_User_Approves_or_Rejects.flow-meta.xml b/force-app/main/default/flows/AP_User_Approves_or_Rejects.flow-meta.xml
index 72f85cf..121358f 100644
--- a/force-app/main/default/flows/AP_User_Approves_or_Rejects.flow-meta.xml
+++ b/force-app/main/default/flows/AP_User_Approves_or_Rejects.flow-meta.xml
@@ -10,7 +10,7 @@
             <assignToReference>curApprovalProcessStepTask.Status__c</assignToReference>
             <operator>Assign</operator>
             <value>
-                <elementReference>placeholderFromButtonBar</elementReference>
+                <elementReference>requestedAction</elementReference>
             </value>
         </assignmentItems>
         <connector>
@@ -66,6 +66,12 @@
         <connector>
             <targetReference>screenFinishMessage</targetReference>
         </connector>
+        <inputAssignments>
+            <field>ApprovalCandidateRecordId__c</field>
+            <value>
+                <elementReference>curApprovalProcessInstance.approvalProcessCandidateRecordId__c</elementReference>
+            </value>
+        </inputAssignments>
         <inputAssignments>
             <field>ApprovalProcessStepTaskId__c</field>
             <value>
@@ -93,7 +99,7 @@
         <inputAssignments>
             <field>Status__c</field>
             <value>
-                <elementReference>placeholderFromButtonBar</elementReference>
+                <elementReference>requestedAction</elementReference>
             </value>
         </inputAssignments>
         <object>ApprovalInstanceHistory__c</object>
@@ -111,7 +117,7 @@
             <field>Id</field>
             <operator>EqualTo</operator>
             <value>
-                <elementReference>processStepTaskId</elementReference>
+                <elementReference>curApprovalProcessStepTask.Parent_Approval_Process_Instance__c</elementReference>
             </value>
         </filters>
         <object>ApprovalProcessInstance__c</object>
@@ -171,6 +177,7 @@
         <queriedFields>Assigned_User__c</queriedFields>
         <queriedFields>Original_Assignee__c</queriedFields>
         <queriedFields>Status__c</queriedFields>
+        <queriedFields>Parent_Approval_Process_Instance__c</queriedFields>
     </recordLookups>
     <recordUpdates>
         <name>Save_Step_Task_Changes</name>
@@ -193,6 +200,11 @@
         <connector>
             <targetReference>Update_Current_Step_Task</targetReference>
         </connector>
+        <fields>
+            <name>dispHeader</name>
+            <fieldText>&lt;p&gt;&lt;b style=&quot;font-size: 20px;&quot;&gt;Please Approve or Reject this record:&lt;/b&gt;&lt;/p&gt;</fieldText>
+            <fieldType>DisplayText</fieldType>
+        </fields>
         <fields>
             <name>candidateRecordDetail</name>
             <extensionName>c:recordDetail</extensionName>
@@ -218,14 +230,61 @@
             <inputParameters>
                 <name>fields</name>
                 <value>
-                    <stringValue>Name, Status, Priority, Subject, Discount, Duration, Contact, Case, Asset, Account</stringValue>
+                    <stringValue>Status, Priority, Subject, Discount, Duration, ContactId, CaseId, AssetId, AccountId</stringValue>
                 </value>
             </inputParameters>
             <isRequired>true</isRequired>
             <storeOutputAutomatically>true</storeOutputAutomatically>
         </fields>
-        <showFooter>true</showFooter>
-        <showHeader>true</showHeader>
+        <fields>
+            <name>showHistoryTable</name>
+            <extensionName>c:approvalProcessHistory</extensionName>
+            <fieldType>ComponentInstance</fieldType>
+            <inputParameters>
+                <name>recordId</name>
+                <value>
+                    <elementReference>curApprovalProcessInstance.Id</elementReference>
+                </value>
+            </inputParameters>
+            <isRequired>true</isRequired>
+            <storeOutputAutomatically>true</storeOutputAutomatically>
+        </fields>
+        <fields>
+            <name>Comments</name>
+            <fieldText>Comments</fieldText>
+            <fieldType>LargeTextArea</fieldType>
+            <isRequired>false</isRequired>
+        </fields>
+        <fields>
+            <name>approveButtons</name>
+            <extensionName>c:buttonSet</extensionName>
+            <fieldType>ComponentInstance</fieldType>
+            <inputParameters>
+                <name>buttonLabels</name>
+                <value>
+                    <stringValue>Approve, Reject</stringValue>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>buttonNavigationDirective</name>
+                <value>
+                    <stringValue>next,next</stringValue>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>buttonAlignment</name>
+                <value>
+                    <stringValue>center</stringValue>
+                </value>
+            </inputParameters>
+            <isRequired>true</isRequired>
+            <outputParameters>
+                <assignToReference>requestedAction</assignToReference>
+                <name>action</name>
+            </outputParameters>
+        </fields>
+        <showFooter>false</showFooter>
+        <showHeader>false</showHeader>
     </screens>
     <screens>
         <name>screenFinishMessage</name>
@@ -250,7 +309,7 @@
             <targetReference>Get_Approval_Process_Step_Task</targetReference>
         </connector>
     </start>
-    <status>Active</status>
+    <status>Draft</status>
     <variables>
         <name>curApprovalProcessHistoryItem</name>
         <dataType>SObject</dataType>
@@ -290,6 +349,13 @@
         <isInput>true</isInput>
         <isOutput>false</isOutput>
     </variables>
+    <variables>
+        <name>requestedAction</name>
+        <dataType>String</dataType>
+        <isCollection>false</isCollection>
+        <isInput>false</isInput>
+        <isOutput>false</isOutput>
+    </variables>
     <variables>
         <name>ShowHistory</name>
         <dataType>Boolean</dataType>
diff --git a/force-app/main/default/flows/CLONE_AP_Manage_Step_Approvers.flow-meta.xml b/force-app/main/default/flows/CLONE_AP_Manage_Step_Approvers.flow-meta.xml
new file mode 100644
index 0000000..b7c56b6
--- /dev/null
+++ b/force-app/main/default/flows/CLONE_AP_Manage_Step_Approvers.flow-meta.xml
@@ -0,0 +1,430 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
+    <assignments>
+        <name>Set_Type_to_Adhoc</name>
+        <label>Set Type to Adhoc</label>
+        <locationX>567</locationX>
+        <locationY>333</locationY>
+        <assignmentItems>
+            <assignToReference>curApprovalStepDef.SingleApproverOrMultiple__c</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <stringValue>Single</stringValue>
+            </value>
+        </assignmentItems>
+        <assignmentItems>
+            <assignToReference>curApprovalStepDef.ApproverType__c</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <stringValue>adhoc</stringValue>
+            </value>
+        </assignmentItems>
+        <connector>
+            <targetReference>Update_Approver</targetReference>
+        </connector>
+    </assignments>
+    <assignments>
+        <name>Set_Type_to_Build_List</name>
+        <label>Set Type to Build List</label>
+        <locationX>763</locationX>
+        <locationY>261</locationY>
+        <assignmentItems>
+            <assignToReference>curApprovalStepDef.SingleApproverOrMultiple__c</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <stringValue>Multiple</stringValue>
+            </value>
+        </assignmentItems>
+        <assignmentItems>
+            <assignToReference>curApprovalStepDef.ApproverType__c</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <stringValue>multiple</stringValue>
+            </value>
+        </assignmentItems>
+        <connector>
+            <targetReference>Update_Step_Def_with_Approver_Details</targetReference>
+        </connector>
+    </assignments>
+    <assignments>
+        <description>User can define a role in the parent approval process, and users with that role become the approved approvers for this step</description>
+        <name>Set_Type_to_Hierarchy</name>
+        <label>Set Type to Hierarchy</label>
+        <locationX>405</locationX>
+        <locationY>559</locationY>
+        <assignmentItems>
+            <assignToReference>curApprovalStepDef.SingleApproverOrMultiple__c</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <stringValue>Single</stringValue>
+            </value>
+        </assignmentItems>
+        <assignmentItems>
+            <assignToReference>curApprovalStepDef.ApproverType__c</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <stringValue>hierarchy-based</stringValue>
+            </value>
+        </assignmentItems>
+        <connector>
+            <targetReference>Update_Approver</targetReference>
+        </connector>
+    </assignments>
+    <assignments>
+        <name>Set_Type_to_Queue</name>
+        <label>Set Type to Queue</label>
+        <locationX>480</locationX>
+        <locationY>456</locationY>
+        <assignmentItems>
+            <assignToReference>curApprover.Name</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <elementReference>QueuePicker</elementReference>
+            </value>
+        </assignmentItems>
+        <assignmentItems>
+            <assignToReference>curApprovalStepDef.SingleApproverOrMultiple__c</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <stringValue>Single</stringValue>
+            </value>
+        </assignmentItems>
+        <assignmentItems>
+            <assignToReference>curApprovalStepDef.ApproverType__c</assignToReference>
+            <operator>Assign</operator>
+            <value>
+                <stringValue>queue</stringValue>
+            </value>
+        </assignmentItems>
+        <connector>
+            <targetReference>Update_Approver</targetReference>
+        </connector>
+    </assignments>
+    <choices>
+        <name>approverType_adhoc</name>
+        <choiceText>Let the submitter choose the approver manually.</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>adhoc</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>approverType_multiple</name>
+        <choiceText>Build approver list</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>multiple</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>approverType_queue</name>
+        <choiceText>Automatically assign to queue.</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>queue</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>approverType_userHierarchyField</name>
+        <choiceText>Automatically assign using the user field selected earlier. ([hierarchy role field name])</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>hierarchy</stringValue>
+        </value>
+    </choices>
+    <decisions>
+        <description>If the type is not a list then just retrieve the single approver</description>
+        <name>One_Approver_or_a_Set</name>
+        <label>One Approver or a Set?</label>
+        <locationX>33</locationX>
+        <locationY>384</locationY>
+        <defaultConnector>
+            <targetReference>GetApprover</targetReference>
+        </defaultConnector>
+        <defaultConnectorLabel>Single Approver</defaultConnectorLabel>
+        <rules>
+            <name>Multiple_Approvers</name>
+            <conditionLogic>and</conditionLogic>
+            <conditions>
+                <leftValueReference>curApprovalStepDef.SingleApproverOrMultiple__c</leftValueReference>
+                <operator>EqualTo</operator>
+                <rightValue>
+                    <stringValue>Multiple</stringValue>
+                </rightValue>
+            </conditions>
+            <connector>
+                <targetReference>GetApprovers</targetReference>
+            </connector>
+            <label>Multiple Approvers</label>
+        </rules>
+    </decisions>
+    <decisions>
+        <name>Which_Approver_Type</name>
+        <label>Which Approver Type?</label>
+        <locationX>395</locationX>
+        <locationY>53</locationY>
+        <defaultConnector>
+            <targetReference>Set_Type_to_Hierarchy</targetReference>
+        </defaultConnector>
+        <defaultConnectorLabel>Hierarchy Field</defaultConnectorLabel>
+        <rules>
+            <name>Build_List</name>
+            <conditionLogic>and</conditionLogic>
+            <conditions>
+                <leftValueReference>ApproverType</leftValueReference>
+                <operator>EqualTo</operator>
+                <rightValue>
+                    <elementReference>approverType_multiple</elementReference>
+                </rightValue>
+            </conditions>
+            <connector>
+                <targetReference>screenSelect_Approvers</targetReference>
+            </connector>
+            <label>Build List</label>
+        </rules>
+        <rules>
+            <name>Use_Queue</name>
+            <conditionLogic>and</conditionLogic>
+            <conditions>
+                <leftValueReference>ApproverType</leftValueReference>
+                <operator>EqualTo</operator>
+                <rightValue>
+                    <elementReference>approverType_queue</elementReference>
+                </rightValue>
+            </conditions>
+            <connector>
+                <targetReference>Set_Type_to_Queue</targetReference>
+            </connector>
+            <label>Use Queue</label>
+        </rules>
+        <rules>
+            <name>Set_Manually</name>
+            <conditionLogic>and</conditionLogic>
+            <conditions>
+                <leftValueReference>ApproverType</leftValueReference>
+                <operator>EqualTo</operator>
+                <rightValue>
+                    <elementReference>approverType_adhoc</elementReference>
+                </rightValue>
+            </conditions>
+            <connector>
+                <targetReference>Set_Type_to_Adhoc</targetReference>
+            </connector>
+            <label>Set Manually</label>
+        </rules>
+    </decisions>
+    <interviewLabel>CLONE AP Manage Step Approvers {!$Flow.CurrentDateTime}</interviewLabel>
+    <label>CLONE AP Manage Step Approvers</label>
+    <processMetadataValues>
+        <name>BuilderType</name>
+        <value>
+            <stringValue>LightningFlowBuilder</stringValue>
+        </value>
+    </processMetadataValues>
+    <processMetadataValues>
+        <name>OriginBuilderType</name>
+        <value>
+            <stringValue>LightningFlowBuilder</stringValue>
+        </value>
+    </processMetadataValues>
+    <processType>Flow</processType>
+    <recordLookups>
+        <name>GetApprover</name>
+        <label>GetApprover</label>
+        <locationX>271</locationX>
+        <locationY>535</locationY>
+        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
+        <connector>
+            <targetReference>Specify_Approvers</targetReference>
+        </connector>
+        <filters>
+            <field>Approval_Process_Step_Definition__c</field>
+            <operator>EqualTo</operator>
+            <value>
+                <elementReference>curApprovalStepDef.Id</elementReference>
+            </value>
+        </filters>
+        <object>Approver__c</object>
+        <outputReference>curApprover</outputReference>
+        <queriedFields>Id</queriedFields>
+    </recordLookups>
+    <recordLookups>
+        <description>Existing approvers that belong to this ApproverSet</description>
+        <name>GetApprovers</name>
+        <label>GetApprovers</label>
+        <locationX>154</locationX>
+        <locationY>230</locationY>
+        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
+        <connector>
+            <targetReference>Specify_Approvers</targetReference>
+        </connector>
+        <filters>
+            <field>Approval_Process_Step_Definition__c</field>
+            <operator>EqualTo</operator>
+            <value>
+                <elementReference>REMOVE_curApprovalStepDefId</elementReference>
+            </value>
+        </filters>
+        <object>Approver__c</object>
+        <outputReference>CurApprovers</outputReference>
+        <queriedFields>Id</queriedFields>
+        <queriedFields>Type__c</queriedFields>
+    </recordLookups>
+    <recordUpdates>
+        <name>Update_Approver</name>
+        <label>Update Approver</label>
+        <locationX>795</locationX>
+        <locationY>450</locationY>
+        <connector>
+            <targetReference>Update_Step_Def_with_Approver_Details</targetReference>
+        </connector>
+        <inputReference>curApprover</inputReference>
+    </recordUpdates>
+    <recordUpdates>
+        <name>Update_Step_Def_with_Approver_Details</name>
+        <label>Update Step Def with Approver Details</label>
+        <locationX>928</locationX>
+        <locationY>449</locationY>
+        <inputReference>curApprovalStepDef</inputReference>
+    </recordUpdates>
+    <screens>
+        <description>get back a list of Approvers and update</description>
+        <name>screenSelect_Approvers</name>
+        <label>Select Approvers</label>
+        <locationX>673</locationX>
+        <locationY>51</locationY>
+        <allowBack>true</allowBack>
+        <allowFinish>true</allowFinish>
+        <allowPause>true</allowPause>
+        <connector>
+            <targetReference>Set_Type_to_Build_List</targetReference>
+        </connector>
+        <fields>
+            <name>Select_Approvers</name>
+            <fieldText>&lt;p&gt;Select Approvers&lt;/p&gt;</fieldText>
+            <fieldType>DisplayText</fieldType>
+        </fields>
+        <fields>
+            <name>role_manager_step_approvers</name>
+            <extensionName>c:roleManager</extensionName>
+            <fieldType>ComponentInstance</fieldType>
+            <inputParameters>
+                <name>addTabName</name>
+                <value>
+                    <stringValue>Add Approvers</stringValue>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>editTabName</name>
+                <value>
+                    <stringValue>Edit Approvers</stringValue>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>recordId</name>
+                <value>
+                    <elementReference>REMOVE_curApprovalStepDefId</elementReference>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>availableObjectTypes</name>
+                <value>
+                    <stringValue>User, Group</stringValue>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>managerName</name>
+                <value>
+                    <stringValue>ManageApprovalStepApprovers</stringValue>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>supportedAddCapabilities</name>
+                <value>
+                    <stringValue>Add, Remove</stringValue>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>supportedEditCapabilities</name>
+                <value>
+                    <stringValue>Remove</stringValue>
+                </value>
+            </inputParameters>
+            <isRequired>true</isRequired>
+            <storeOutputAutomatically>true</storeOutputAutomatically>
+        </fields>
+        <showFooter>true</showFooter>
+        <showHeader>true</showHeader>
+    </screens>
+    <screens>
+        <name>Specify_Approvers</name>
+        <label>Specify Approvers</label>
+        <locationX>263</locationX>
+        <locationY>70</locationY>
+        <allowBack>true</allowBack>
+        <allowFinish>true</allowFinish>
+        <allowPause>true</allowPause>
+        <connector>
+            <targetReference>Which_Approver_Type</targetReference>
+        </connector>
+        <fields>
+            <name>ApproverType</name>
+            <choiceReferences>approverType_adhoc</choiceReferences>
+            <choiceReferences>approverType_userHierarchyField</choiceReferences>
+            <choiceReferences>approverType_queue</choiceReferences>
+            <choiceReferences>approverType_multiple</choiceReferences>
+            <dataType>String</dataType>
+            <fieldText>ApproverType</fieldText>
+            <fieldType>RadioButtons</fieldType>
+            <isRequired>false</isRequired>
+        </fields>
+        <fields>
+            <name>QueuePicker</name>
+            <dataType>String</dataType>
+            <fieldText>Select Queue (lookup placeholder)</fieldText>
+            <fieldType>InputField</fieldType>
+            <isRequired>false</isRequired>
+        </fields>
+        <showFooter>true</showFooter>
+        <showHeader>true</showHeader>
+    </screens>
+    <start>
+        <locationX>50</locationX>
+        <locationY>50</locationY>
+        <connector>
+            <targetReference>One_Approver_or_a_Set</targetReference>
+        </connector>
+    </start>
+    <status>Draft</status>
+    <variables>
+        <name>curApprovalStepDef</name>
+        <dataType>SObject</dataType>
+        <isCollection>false</isCollection>
+        <isInput>true</isInput>
+        <isOutput>true</isOutput>
+        <objectType>ApprovalProcessStepDefinition__c</objectType>
+    </variables>
+    <variables>
+        <name>curApprover</name>
+        <dataType>SObject</dataType>
+        <isCollection>false</isCollection>
+        <isInput>false</isInput>
+        <isOutput>false</isOutput>
+        <objectType>Approver__c</objectType>
+    </variables>
+    <variables>
+        <name>CurApprovers</name>
+        <dataType>SObject</dataType>
+        <isCollection>true</isCollection>
+        <isInput>false</isInput>
+        <isOutput>false</isOutput>
+        <objectType>Approver__c</objectType>
+    </variables>
+    <variables>
+        <name>REMOVE_curApprovalStepDefId</name>
+        <dataType>String</dataType>
+        <isCollection>false</isCollection>
+        <isInput>true</isInput>
+        <isOutput>true</isOutput>
+    </variables>
+</Flow>
diff --git a/force-app/main/default/flows/Clone_AP_Manage_Approval_Process_Step.flow-meta.xml b/force-app/main/default/flows/Clone_AP_Manage_Approval_Process_Step.flow-meta.xml
new file mode 100644
index 0000000..ff4a871
--- /dev/null
+++ b/force-app/main/default/flows/Clone_AP_Manage_Approval_Process_Step.flow-meta.xml
@@ -0,0 +1,549 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<Flow xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
+    <choices>
+        <name>AlwaysEnter</name>
+        <choiceText>All records should enter this step.</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>always</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>approveRecord</name>
+        <choiceText>Approve Record</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>approve</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>Back1Step</name>
+        <choiceText>Perform ONLY the rejection actions for this step and send the approval request back to the most recent approver.</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>Back1Step</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>CriteriaBased</name>
+        <choiceText>Evaluate some expression criteria</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>CriteriaExpression</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>CriteriaOrFormula</name>
+        <choiceText>Use criteria or a formula</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>criteria</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>EnterStep</name>
+        <choiceText>Enter the step</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>enterStep</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>EvaluateFormula</name>
+        <choiceText>Evaluate a formula</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>formula</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>FinalRejection</name>
+        <choiceText>Perform all rejection actions for this step AND all final rejection actions. (Final Rejection)</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>finalRejection</stringValue>
+        </value>
+    </choices>
+    <choices>
+        <name>SkipToNextStep</name>
+        <choiceText>Go to next step (skip this one)</choiceText>
+        <dataType>String</dataType>
+        <value>
+            <stringValue>skip</stringValue>
+        </value>
+    </choices>
+    <decisions>
+        <description>Rejection behavior is not configurable for the first step. This is probably because &quot;Back 1 Step&quot; doesn&#39;t make any sense. This feels hacky. Better solution would probably be to provide a checkbox that allows Final Rejection to be instantiated, and not show the Back 1 step choice</description>
+        <name>Check_Step_Order</name>
+        <label>Check Step Order</label>
+        <locationX>1459</locationX>
+        <locationY>153</locationY>
+        <defaultConnector>
+            <targetReference>Rejection_Behavior</targetReference>
+        </defaultConnector>
+        <defaultConnectorLabel>Not First Step</defaultConnectorLabel>
+        <rules>
+            <name>This_is_First_Step</name>
+            <conditionLogic>and</conditionLogic>
+            <conditions>
+                <leftValueReference>curApprovalProcessStepDefinition.Name</leftValueReference>
+                <operator>EqualTo</operator>
+                <rightValue>
+                    <stringValue>foo</stringValue>
+                </rightValue>
+            </conditions>
+            <connector>
+                <targetReference>Update_Approval_Step</targetReference>
+            </connector>
+            <label>This is First Step</label>
+        </rules>
+    </decisions>
+    <decisions>
+        <name>Similar_Name_Exist</name>
+        <label>Similar Name Exist</label>
+        <locationX>369</locationX>
+        <locationY>519</locationY>
+        <defaultConnector>
+            <targetReference>Create_Approval_Process_Step_Record</targetReference>
+        </defaultConnector>
+        <defaultConnectorLabel>Doesn&#39;t Exist</defaultConnectorLabel>
+        <rules>
+            <name>Exist</name>
+            <conditionLogic>and</conditionLogic>
+            <conditions>
+                <leftValueReference>matchingApprovalProcessStepDefinition</leftValueReference>
+                <operator>IsNull</operator>
+                <rightValue>
+                    <booleanValue>false</booleanValue>
+                </rightValue>
+            </conditions>
+            <connector>
+                <targetReference>Message_Screen</targetReference>
+            </connector>
+            <label>Exists</label>
+        </rules>
+    </decisions>
+    <decisions>
+        <name>Which_Operation</name>
+        <label>Which Operation?</label>
+        <locationX>625</locationX>
+        <locationY>154</locationY>
+        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
+        <rules>
+            <name>AddStepPath</name>
+            <conditionLogic>and</conditionLogic>
+            <conditions>
+                <leftValueReference>requestedStepAction</leftValueReference>
+                <operator>EqualTo</operator>
+                <rightValue>
+                    <stringValue>Add</stringValue>
+                </rightValue>
+            </conditions>
+            <connector>
+                <targetReference>Create_Step</targetReference>
+            </connector>
+            <label>Add Step</label>
+        </rules>
+        <rules>
+            <name>EditStepPath</name>
+            <conditionLogic>and</conditionLogic>
+            <conditions>
+                <leftValueReference>requestedStepAction</leftValueReference>
+                <operator>EqualTo</operator>
+                <rightValue>
+                    <stringValue>Edit</stringValue>
+                </rightValue>
+            </conditions>
+            <connector>
+                <targetReference>Select_Step_Actions</targetReference>
+            </connector>
+            <label>Edit Step</label>
+        </rules>
+        <rules>
+            <name>DeleteStepPath</name>
+            <conditionLogic>and</conditionLogic>
+            <conditions>
+                <leftValueReference>requestedStepAction</leftValueReference>
+                <operator>EqualTo</operator>
+                <rightValue>
+                    <stringValue>Delete</stringValue>
+                </rightValue>
+            </conditions>
+            <label>Delete Step</label>
+        </rules>
+    </decisions>
+    <dynamicChoiceSets>
+        <name>rejectBehaviorPCS</name>
+        <dataType>Picklist</dataType>
+        <displayField xsi:nil="true"/>
+        <object xsi:nil="true"/>
+        <picklistField>RejectBehavior__c</picklistField>
+        <picklistObject>ApprovalProcessStepDefinition__c</picklistObject>
+    </dynamicChoiceSets>
+    <interviewLabel>Clone AP Manage Approval Process Step {!$Flow.CurrentDateTime}</interviewLabel>
+    <label>Clone AP Manage Approval Process Step</label>
+    <processMetadataValues>
+        <name>BuilderType</name>
+        <value>
+            <stringValue>LightningFlowBuilder</stringValue>
+        </value>
+    </processMetadataValues>
+    <processMetadataValues>
+        <name>OriginBuilderType</name>
+        <value>
+            <stringValue>LightningFlowBuilder</stringValue>
+        </value>
+    </processMetadataValues>
+    <processType>Flow</processType>
+    <recordCreates>
+        <name>Create_Approval_Process_Step_Record</name>
+        <label>Create Approval Process Step Record</label>
+        <locationX>583</locationX>
+        <locationY>517</locationY>
+        <connector>
+            <targetReference>Step_Added</targetReference>
+        </connector>
+        <inputAssignments>
+            <field>ApprovalProcessDefinition__c</field>
+            <value>
+                <elementReference>curApprovalProcessDefinition.Id</elementReference>
+            </value>
+        </inputAssignments>
+        <inputAssignments>
+            <field>Name</field>
+            <value>
+                <elementReference>Proposed_Step_Name</elementReference>
+            </value>
+        </inputAssignments>
+        <object>ApprovalProcessStepDefinition__c</object>
+    </recordCreates>
+    <recordLookups>
+        <name>Get_Similar_Name_Record</name>
+        <label>Get Similar Name Record</label>
+        <locationX>420</locationX>
+        <locationY>311</locationY>
+        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
+        <connector>
+            <targetReference>Similar_Name_Exist</targetReference>
+        </connector>
+        <filters>
+            <field>Name</field>
+            <operator>EqualTo</operator>
+            <value>
+                <elementReference>Proposed_Step_Name</elementReference>
+            </value>
+        </filters>
+        <object>ApprovalProcessStepDefinition__c</object>
+        <outputReference>matchingApprovalProcessStepDefinition</outputReference>
+        <queriedFields>Id</queriedFields>
+    </recordLookups>
+    <recordUpdates>
+        <name>Update_Approval_Step</name>
+        <label>Update Approval Step</label>
+        <locationX>1752</locationX>
+        <locationY>179</locationY>
+        <connector>
+            <targetReference>Updated_Successfully</targetReference>
+        </connector>
+        <filters>
+            <field>Id</field>
+            <operator>EqualTo</operator>
+            <value>
+                <elementReference>curApprovalProcessStepDefinition.Id</elementReference>
+            </value>
+        </filters>
+        <inputAssignments>
+            <field>ApprovalFlow_API_Name__c</field>
+            <value>
+                <elementReference>approvalFlowName</elementReference>
+            </value>
+        </inputAssignments>
+        <inputAssignments>
+            <field>RejectBehavior__c</field>
+            <value>
+                <elementReference>rejectBehaviorPCS</elementReference>
+            </value>
+        </inputAssignments>
+        <inputAssignments>
+            <field>RejectionFlow_API_Name__c</field>
+            <value>
+                <elementReference>rejectionFlowName</elementReference>
+            </value>
+        </inputAssignments>
+        <object>ApprovalProcessStepDefinition__c</object>
+    </recordUpdates>
+    <screens>
+        <name>Create_Step</name>
+        <label>Create Step</label>
+        <locationX>197</locationX>
+        <locationY>267</locationY>
+        <allowBack>true</allowBack>
+        <allowFinish>true</allowFinish>
+        <allowPause>true</allowPause>
+        <connector>
+            <targetReference>Get_Similar_Name_Record</targetReference>
+        </connector>
+        <fields>
+            <name>AddStepHeading</name>
+            <fieldText>&lt;p&gt;&lt;b style=&quot;font-size: 18px;&quot;&gt;Add Approval Process  Step&lt;/b&gt;&lt;/p&gt;</fieldText>
+            <fieldType>DisplayText</fieldType>
+        </fields>
+        <fields>
+            <name>Proposed_Step_Name</name>
+            <dataType>String</dataType>
+            <fieldText>Approval Step Name</fieldText>
+            <fieldType>InputField</fieldType>
+            <isRequired>true</isRequired>
+        </fields>
+        <showFooter>true</showFooter>
+        <showHeader>false</showHeader>
+    </screens>
+    <screens>
+        <name>Message_Screen</name>
+        <label>Message Screen</label>
+        <locationX>193</locationX>
+        <locationY>525</locationY>
+        <allowBack>true</allowBack>
+        <allowFinish>true</allowFinish>
+        <allowPause>true</allowPause>
+        <connector>
+            <targetReference>Create_Step</targetReference>
+        </connector>
+        <fields>
+            <name>DisplayTextScreenMessage</name>
+            <fieldText>&lt;p&gt;A step with this name already exists. &lt;/p&gt;</fieldText>
+            <fieldType>DisplayText</fieldType>
+        </fields>
+        <showFooter>true</showFooter>
+        <showHeader>false</showHeader>
+    </screens>
+    <screens>
+        <name>Rejection_Behavior</name>
+        <label>Configure Rejection Behavior</label>
+        <locationX>1466</locationX>
+        <locationY>373</locationY>
+        <allowBack>true</allowBack>
+        <allowFinish>true</allowFinish>
+        <allowPause>true</allowPause>
+        <connector>
+            <targetReference>Update_Approval_Step</targetReference>
+        </connector>
+        <fields>
+            <name>What_should_happen_if_the_approver_rejects_this_request</name>
+            <choiceReferences>rejectBehaviorPCS</choiceReferences>
+            <dataType>String</dataType>
+            <fieldText>What should happen if the approver rejects this request?</fieldText>
+            <fieldType>RadioButtons</fieldType>
+            <isRequired>false</isRequired>
+        </fields>
+        <showFooter>true</showFooter>
+        <showHeader>true</showHeader>
+    </screens>
+    <screens>
+        <name>Select_Step_Actions</name>
+        <label>Select Step Actions</label>
+        <locationX>983</locationX>
+        <locationY>152</locationY>
+        <allowBack>true</allowBack>
+        <allowFinish>true</allowFinish>
+        <allowPause>true</allowPause>
+        <connector>
+            <targetReference>Manage_Approvers_for_Step</targetReference>
+        </connector>
+        <fields>
+            <name>EditScreenDisplayText</name>
+            <fieldText>&lt;p&gt;&lt;b style=&quot;font-size: 18px;&quot;&gt;Select Step Actions&lt;/b&gt;&lt;/p&gt;</fieldText>
+            <fieldType>DisplayText</fieldType>
+        </fields>
+        <fields>
+            <name>CaseStepName</name>
+            <fieldText>&lt;p&gt;&lt;b&gt;Step Name &lt;/b&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(62, 62, 60);&quot;&gt;{!curApprovalProcessStepDefinition.Name}&lt;/span&gt;&lt;/p&gt;</fieldText>
+            <fieldType>DisplayText</fieldType>
+        </fields>
+        <fields>
+            <name>ApprovalFlow</name>
+            <extensionName>c:flowListFSC</extensionName>
+            <fieldType>ComponentInstance</fieldType>
+            <inputParameters>
+                <name>label</name>
+                <value>
+                    <stringValue>Run which flow when this step is APPROVED:</stringValue>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>selectedFlowApiName</name>
+                <value>
+                    <elementReference>curApprovalProcessStepDefinition.ApprovalFlow_API_Name__c</elementReference>
+                </value>
+            </inputParameters>
+            <isRequired>true</isRequired>
+            <outputParameters>
+                <assignToReference>approvalFlowName</assignToReference>
+                <name>selectedFlowApiName</name>
+            </outputParameters>
+        </fields>
+        <fields>
+            <name>RejectionFlow</name>
+            <extensionName>c:flowListFSC</extensionName>
+            <fieldType>ComponentInstance</fieldType>
+            <inputParameters>
+                <name>label</name>
+                <value>
+                    <stringValue>Run this flow when this Approval Step is REJECTED:</stringValue>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>showActiveFlowsOnly</name>
+                <value>
+                    <booleanValue>false</booleanValue>
+                </value>
+            </inputParameters>
+            <inputParameters>
+                <name>selectedFlowApiName</name>
+                <value>
+                    <elementReference>curApprovalProcessStepDefinition.RejectionFlow_API_Name__c</elementReference>
+                </value>
+            </inputParameters>
+            <isRequired>true</isRequired>
+            <outputParameters>
+                <assignToReference>rejectionFlowName</assignToReference>
+                <name>selectedFlowApiName</name>
+            </outputParameters>
+        </fields>
+        <showFooter>true</showFooter>
+        <showHeader>false</showHeader>
+    </screens>
+    <screens>
+        <description>IMPORTANT! This screen forces an important transaction. removing this will cause bugs.</description>
+        <name>Step_Added</name>
+        <label>Step Added</label>
+        <locationX>734</locationX>
+        <locationY>520</locationY>
+        <allowBack>true</allowBack>
+        <allowFinish>true</allowFinish>
+        <allowPause>true</allowPause>
+        <fields>
+            <name>dispAddComplete</name>
+            <fieldText>&lt;p&gt;Step added.&lt;/p&gt;</fieldText>
+            <fieldType>DisplayText</fieldType>
+        </fields>
+        <showFooter>true</showFooter>
+        <showHeader>true</showHeader>
+    </screens>
+    <screens>
+        <name>Updated_Successfully</name>
+        <label>Updated Successfully</label>
+        <locationX>1753</locationX>
+        <locationY>398</locationY>
+        <allowBack>true</allowBack>
+        <allowFinish>true</allowFinish>
+        <allowPause>true</allowPause>
+        <fields>
+            <name>UpdateMessageScreen</name>
+            <fieldText>&lt;p&gt;&lt;b&gt;Approval Process Step Updated Successfully!&lt;/b&gt;&lt;/p&gt;</fieldText>
+            <fieldType>DisplayText</fieldType>
+        </fields>
+        <showFooter>true</showFooter>
+        <showHeader>false</showHeader>
+    </screens>
+    <start>
+        <locationX>50</locationX>
+        <locationY>145</locationY>
+        <connector>
+            <targetReference>Which_Operation</targetReference>
+        </connector>
+    </start>
+    <status>Draft</status>
+    <subflows>
+        <name>Manage_Approvers_for_Step</name>
+        <label>Manage Approvers for Step</label>
+        <locationX>1321</locationX>
+        <locationY>144</locationY>
+        <connector>
+            <targetReference>Check_Step_Order</targetReference>
+        </connector>
+        <flowName>AP_Manage_Step_Approvers</flowName>
+        <inputAssignments>
+            <name>curApprovalStepDef</name>
+            <value>
+                <elementReference>curApprovalProcessStepDefinition</elementReference>
+            </value>
+        </inputAssignments>
+    </subflows>
+    <subflows>
+        <name>Specify_Entry_Criteria_for_Step</name>
+        <label>Specify Entry Criteria for Step</label>
+        <locationX>1145</locationX>
+        <locationY>50</locationY>
+        <connector>
+            <targetReference>Manage_Approvers_for_Step</targetReference>
+        </connector>
+        <flowName>AP_Specify_Entry_Criteria</flowName>
+        <inputAssignments>
+            <name>curApprovalProcessStepDefinition</name>
+            <value>
+                <elementReference>curApprovalProcessStepDefinition</elementReference>
+            </value>
+        </inputAssignments>
+    </subflows>
+    <variables>
+        <name>approvalFlowName</name>
+        <dataType>String</dataType>
+        <isCollection>false</isCollection>
+        <isInput>false</isInput>
+        <isOutput>false</isOutput>
+    </variables>
+    <variables>
+        <name>curAction</name>
+        <dataType>String</dataType>
+        <isCollection>false</isCollection>
+        <isInput>true</isInput>
+        <isOutput>false</isOutput>
+    </variables>
+    <variables>
+        <name>curApprovalProcessDefinition</name>
+        <dataType>SObject</dataType>
+        <isCollection>false</isCollection>
+        <isInput>true</isInput>
+        <isOutput>false</isOutput>
+        <objectType>ApprovalProcessDefinition__c</objectType>
+    </variables>
+    <variables>
+        <name>curApprovalProcessStepDefinition</name>
+        <dataType>SObject</dataType>
+        <isCollection>false</isCollection>
+        <isInput>true</isInput>
+        <isOutput>true</isOutput>
+        <objectType>ApprovalProcessStepDefinition__c</objectType>
+    </variables>
+    <variables>
+        <description>Used to check for duplicate names</description>
+        <name>matchingApprovalProcessStepDefinition</name>
+        <dataType>SObject</dataType>
+        <isCollection>false</isCollection>
+        <isInput>false</isInput>
+        <isOutput>false</isOutput>
+        <objectType>ApprovalProcessStepDefinition__c</objectType>
+    </variables>
+    <variables>
+        <name>rejectionFlowName</name>
+        <dataType>String</dataType>
+        <isCollection>false</isCollection>
+        <isInput>false</isInput>
+        <isOutput>false</isOutput>
+    </variables>
+    <variables>
+        <name>requestedStepAction</name>
+        <dataType>String</dataType>
+        <isCollection>false</isCollection>
+        <isInput>true</isInput>
+        <isOutput>false</isOutput>
+    </variables>
+    <variables>
+        <name>SelectedApprovalProcessStepId</name>
+        <dataType>String</dataType>
+        <isCollection>false</isCollection>
+        <isInput>true</isInput>
+        <isOutput>true</isOutput>
+    </variables>
+</Flow>
diff --git a/force-app/main/default/flows/Manage_Step_Reordering.flow-meta.xml b/force-app/main/default/flows/Manage_Step_Reordering.flow-meta.xml
index 091b9bd..ca113a5 100644
--- a/force-app/main/default/flows/Manage_Step_Reordering.flow-meta.xml
+++ b/force-app/main/default/flows/Manage_Step_Reordering.flow-meta.xml
@@ -76,7 +76,7 @@
         <name>Iterate_over_Names</name>
         <label>Iterate over Names</label>
         <locationX>369</locationX>
-        <locationY>48</locationY>
+        <locationY>50</locationY>
         <assignNextValueToReference>currentName</assignNextValueToReference>
         <collectionReference>orderedStepNames</collectionReference>
         <iterationOrder>Asc</iterationOrder>
@@ -107,21 +107,43 @@
         <locationY>49</locationY>
         <inputReference>modifiedApprovalProcessStepDefinitions</inputReference>
     </recordUpdates>
+    <screens>
+        <name>console1</name>
+        <label>console1</label>
+        <locationX>267</locationX>
+        <locationY>50</locationY>
+        <allowBack>true</allowBack>
+        <allowFinish>true</allowFinish>
+        <allowPause>true</allowPause>
+        <connector>
+            <targetReference>Iterate_over_Names</targetReference>
+        </connector>
+        <fields>
+            <name>dispSelected</name>
+            <fieldText>&lt;p&gt;Selected rows are:{!selectedRecords}&lt;/p&gt;&lt;p&gt;sorted all rows are: {!sortedSteps}&lt;/p&gt;</fieldText>
+            <fieldType>DisplayText</fieldType>
+        </fields>
+        <showFooter>true</showFooter>
+        <showHeader>true</showHeader>
+    </screens>
     <screens>
         <name>Order_Steps</name>
         <label>Order Steps</label>
-        <locationX>202</locationX>
-        <locationY>49</locationY>
+        <locationX>162</locationX>
+        <locationY>50</locationY>
         <allowBack>true</allowBack>
         <allowFinish>true</allowFinish>
         <allowPause>true</allowPause>
+        <connector>
+            <targetReference>console1</targetReference>
+        </connector>
         <fields>
             <name>dispReorderSubhead</name>
             <fieldText>&lt;p&gt;&lt;b&gt;Reorder the Approval Process Steps&lt;/b&gt;&lt;/p&gt;</fieldText>
             <fieldType>DisplayText</fieldType>
         </fields>
         <fields>
-            <name>manage_reordering</name>
+            <name>reorderingComponent</name>
             <extensionName>c:manageApprovalProcessStep</extensionName>
             <fieldType>ComponentInstance</fieldType>
             <inputParameters>
@@ -131,7 +153,10 @@
                 </value>
             </inputParameters>
             <isRequired>true</isRequired>
-            <storeOutputAutomatically>true</storeOutputAutomatically>
+            <outputParameters>
+                <assignToReference>selectedRecords</assignToReference>
+                <name>selectedRecords</name>
+            </outputParameters>
         </fields>
         <showFooter>true</showFooter>
         <showHeader>true</showHeader>
@@ -202,4 +227,18 @@
         <isOutput>false</isOutput>
         <objectType>ApprovalProcessStepDefinition__c</objectType>
     </variables>
+    <variables>
+        <name>selectedRecords</name>
+        <dataType>String</dataType>
+        <isCollection>true</isCollection>
+        <isInput>false</isInput>
+        <isOutput>false</isOutput>
+    </variables>
+    <variables>
+        <name>sortedSteps</name>
+        <dataType>String</dataType>
+        <isCollection>true</isCollection>
+        <isInput>false</isInput>
+        <isOutput>false</isOutput>
+    </variables>
 </Flow>
diff --git a/force-app/main/default/lwc/approvalProcessHistory/approvalProcessHistory.js b/force-app/main/default/lwc/approvalProcessHistory/approvalProcessHistory.js
index e57e265..4eb2391 100644
--- a/force-app/main/default/lwc/approvalProcessHistory/approvalProcessHistory.js
+++ b/force-app/main/default/lwc/approvalProcessHistory/approvalProcessHistory.js
@@ -1,11 +1,20 @@
 import {LightningElement, api, track, wire} from 'lwc';
 import getApprovalProcessHistory from '@salesforce/apex/ApprovalProcessHelper.getApprovalProcessHistory';
 import {NavigationMixin} from 'lightning/navigation';
+import {logger} from 'c/lwcLogger';
 
 export default class approvalProcessHistory extends NavigationMixin(LightningElement) {
-    @api recordId = '';
+    @api recordId;
     @track historyData;
     @track openSteps = [];
+    connectedCallback() {
+        logger(this.log, this.source, `recordId is now ${this.recordId}`);
+        
+            
+
+    }
+   
+
 
     @wire(getApprovalProcessHistory, {processId: '$recordId'})
     _getApprovalProcessHistory({error, data}) {
diff --git a/force-app/main/default/lwc/approvalProcessHistory/approvalProcessHistory.js-meta.xml b/force-app/main/default/lwc/approvalProcessHistory/approvalProcessHistory.js-meta.xml
index d770c46..7916bff 100644
--- a/force-app/main/default/lwc/approvalProcessHistory/approvalProcessHistory.js-meta.xml
+++ b/force-app/main/default/lwc/approvalProcessHistory/approvalProcessHistory.js-meta.xml
@@ -8,4 +8,9 @@
         <target>lightning__FlowScreen</target>
         <target>lightning__RecordPage</target>
     </targets>
+    <targetConfigs>
+        <targetConfig targets="lightning__FlowScreen">
+            <property name="recordId" type="String"  required="true" default="{!recordId}"></property>
+        </targetConfig>
+    </targetConfigs>
 </LightningComponentBundle>
diff --git a/force-app/main/default/lwc/buttonSet/buttonSet.html b/force-app/main/default/lwc/buttonSet/buttonSet.html
index f1d4768..46de1c1 100644
--- a/force-app/main/default/lwc/buttonSet/buttonSet.html
+++ b/force-app/main/default/lwc/buttonSet/buttonSet.html
@@ -1,4 +1,5 @@
 <template>
+    
     <div class="slds-clearfix">
         <div class={elementClass}>
             <template for:each={buttons} for:item="button">
diff --git a/force-app/main/default/lwc/buttonSet/buttonSet.js b/force-app/main/default/lwc/buttonSet/buttonSet.js
index 6c71526..3d556d0 100644
--- a/force-app/main/default/lwc/buttonSet/buttonSet.js
+++ b/force-app/main/default/lwc/buttonSet/buttonSet.js
@@ -1,3 +1,7 @@
+//buttonAlignment can be right, left?, center?
+//buttonLabel example: Go Back, Go Forward, Game Over
+//buttonNavigationDirective example, back,next,finish
+
 import {LightningElement, api} from 'lwc';
 import {
     FlowNavigationNextEvent,
@@ -6,11 +10,21 @@ import {
     FlowNavigationPauseEvent,
     FlowNavigationResumeEvent
 } from 'lightning/flowSupport';
+import {logger} from 'c/lwcLogger';
 
 export default class buttonSet extends LightningElement {
     @api buttonLabels;
     @api buttonAlignment;
     @api buttonNavigationDirective;
+    @api action; //what was clicked?
+
+    connectedCallback() {
+        logger(this.log, this.source, `buttonLabels is now ${this.buttonLabels}`);
+        logger(this.log, this.source, `buttonAlignment is now ${this.buttonAlignment}`);
+        logger(this.log, this.source, `buttonNavigationDirective is now ${this.buttonNavigationDirective}`);  
+        //logger(this.log, this.source, `buttons is now ${this.buttons()}`);  
+
+    }
 
     get buttons() {
         let buttonDescriptor = [];
@@ -54,6 +68,9 @@ export default class buttonSet extends LightningElement {
     handleButtonClick(event) {
         let nextNavigationEvent;
         let eventParam = '';
+        this.action = event.target.label;
+        logger(this.log, this.source, `setting action prop to${this.action}`);  
+        
         switch (event.currentTarget.dataset.navigation) {
             case 'next':
                 nextNavigationEvent = new FlowNavigationNextEvent(eventParam);
diff --git a/force-app/main/default/lwc/buttonSet/buttonSet.js-meta.xml b/force-app/main/default/lwc/buttonSet/buttonSet.js-meta.xml
index 017d931..99d4610 100644
--- a/force-app/main/default/lwc/buttonSet/buttonSet.js-meta.xml
+++ b/force-app/main/default/lwc/buttonSet/buttonSet.js-meta.xml
@@ -13,6 +13,8 @@
             <property name="buttonLabels" type="String"></property>
             <property name="buttonNavigationDirective" type="String"></property>
             <property name="buttonAlignment" type="String" datasource="left,center,right"></property>
+            <property name="action" type="String"> </property>
+
         </targetConfig>
     </targetConfigs>
 </LightningComponentBundle>
diff --git a/force-app/main/default/lwc/manageApprovalProcessStep/manageApprovalProcessStep.js b/force-app/main/default/lwc/manageApprovalProcessStep/manageApprovalProcessStep.js
index 60e1ef6..0b1cde8 100644
--- a/force-app/main/default/lwc/manageApprovalProcessStep/manageApprovalProcessStep.js
+++ b/force-app/main/default/lwc/manageApprovalProcessStep/manageApprovalProcessStep.js
@@ -5,8 +5,8 @@ import saveApprovalSteps from '@salesforce/apex/ManageApprovalSteps.saveApproval
 
 export default class manageApprovalProcessStep extends LightningElement {
     @api approvalProcessId;
-    @track steps = [];
-    @track selectedRecords = [];
+    @api steps = [];   //alex: removed @track here so I could expose this to flow
+    @api selectedRecords = []; //alex: removed @track here so I could expose this to flow
 
     @wire(getApprovalProcessSteps, {approvalProcessId: '$approvalProcessId'})
     _getApprovalProcessSteps(result) {
diff --git a/force-app/main/default/lwc/manageApprovalProcessStep/manageApprovalProcessStep.js-meta.xml b/force-app/main/default/lwc/manageApprovalProcessStep/manageApprovalProcessStep.js-meta.xml
index 0c2e43f..f325d26 100644
--- a/force-app/main/default/lwc/manageApprovalProcessStep/manageApprovalProcessStep.js-meta.xml
+++ b/force-app/main/default/lwc/manageApprovalProcessStep/manageApprovalProcessStep.js-meta.xml
@@ -11,6 +11,8 @@
     <targetConfigs>
         <targetConfig targets="lightning__FlowScreen">
             <property name="approvalProcessId" type="String" required="true" default="{!recordId}"></property>
+            <property name="selectedRecords" type="String[]" ></property>
+            <property name="steps"  label="Sorted Strings" type="String[]" ></property> 
         </targetConfig>
     </targetConfigs>
 </LightningComponentBundle>
diff --git a/force-app/main/default/objects/ApprovalInstanceHistory__c/listViews/All.listView-meta.xml b/force-app/main/default/objects/ApprovalInstanceHistory__c/listViews/All.listView-meta.xml
new file mode 100644
index 0000000..b216a90
--- /dev/null
+++ b/force-app/main/default/objects/ApprovalInstanceHistory__c/listViews/All.listView-meta.xml
@@ -0,0 +1,11 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<ListView xmlns="http://soap.sforce.com/2006/04/metadata">
+    <fullName>All</fullName>
+    <columns>NAME</columns>
+    <columns>Approval_Process_Instance__c</columns>
+    <columns>ApprovalProcessStepInstance__c</columns>
+    <columns>ApprovalProcessStepTaskId__c</columns>
+    <columns>ApprovalCandidateRecordId__c</columns>
+    <filterScope>Mine</filterScope>
+    <label>All</label>
+</ListView>
diff --git a/force-app/main/default/objects/ApprovalProcessDefinition__c/listViews/All.listView-meta.xml b/force-app/main/default/objects/ApprovalProcessDefinition__c/listViews/All.listView-meta.xml
index d505851..017c489 100644
--- a/force-app/main/default/objects/ApprovalProcessDefinition__c/listViews/All.listView-meta.xml
+++ b/force-app/main/default/objects/ApprovalProcessDefinition__c/listViews/All.listView-meta.xml
@@ -1,6 +1,8 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <ListView xmlns="http://soap.sforce.com/2006/04/metadata">
     <fullName>All</fullName>
+    <columns>NAME</columns>
+    <columns>OBJECT_ID</columns>
     <filterScope>Everything</filterScope>
     <label>All</label>
 </ListView>
diff --git a/force-app/main/default/objects/ApprovalProcessInstance__c/listViews/All.listView-meta.xml b/force-app/main/default/objects/ApprovalProcessInstance__c/listViews/All.listView-meta.xml
new file mode 100644
index 0000000..436557a
--- /dev/null
+++ b/force-app/main/default/objects/ApprovalProcessInstance__c/listViews/All.listView-meta.xml
@@ -0,0 +1,7 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<ListView xmlns="http://soap.sforce.com/2006/04/metadata">
+    <fullName>All</fullName>
+    <columns>NAME</columns>
+    <filterScope>Mine</filterScope>
+    <label>All</label>
+</ListView>
diff --git a/force-app/main/default/permissionsets/ApprovalsOnFlow.permissionset-meta.xml b/force-app/main/default/permissionsets/ApprovalsOnFlow.permissionset-meta.xml
index 53e2b46..e8d4a9d 100644
--- a/force-app/main/default/permissionsets/ApprovalsOnFlow.permissionset-meta.xml
+++ b/force-app/main/default/permissionsets/ApprovalsOnFlow.permissionset-meta.xml
@@ -55,6 +55,11 @@
         <field>ApprovalProcessDefinition__c.ClassicEmailTemplateName__c</field>
         <readable>true</readable>
     </fieldPermissions>
+    <fieldPermissions>
+        <editable>true</editable>
+        <field>ApprovalProcessDefinition__c.ContextObjectTypeName__c</field>
+        <readable>true</readable>
+    </fieldPermissions>
     <fieldPermissions>
         <editable>true</editable>
         <field>ApprovalProcessDefinition__c.Description__c</field>
@@ -120,6 +125,11 @@
         <field>ApprovalProcessInstance__c.State__c</field>
         <readable>true</readable>
     </fieldPermissions>
+    <fieldPermissions>
+        <editable>true</editable>
+        <field>ApprovalProcessInstance__c.approvalProcessCandidateRecordId__c</field>
+        <readable>true</readable>
+    </fieldPermissions>
     <fieldPermissions>
         <editable>true</editable>
         <field>ApprovalProcessStepDefinition__c.AllowDelegate__c</field>
-- 
2.21.0 (Apple Git-120)

